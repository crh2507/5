<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>RayBOT Chat PWA</title>
   <link rel="manifest" href="manifest.json">
   <style>
       body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
       .hidden { display: none; }
       .chat-box { max-width: 400px; margin: auto; padding: 10px; border: 1px solid #ddd; }
       .bot-message, .user-message { padding: 5px; margin: 5px; }
       .bot-message { background-color: #f0f0f0; }
       input, button { margin: 5px; padding: 8px; width: 90%; max-width: 300px; }
       button { cursor: pointer; }
   </style>
</head>
<body>
   <h1>RayBOT Chat</h1>
   <div class="chat-box" id="chat-box">
       <div class="bot-message">Welcome! I'm RayBOT. Type or speak to start chatting.</div>
   </div>
   <input type="text" id="user-input" placeholder="Type a message" aria-label="Chat message input">
   <button id="send-btn" aria-label="Send message">Send</button>
   <button id="voice-btn" aria-label="Speak message">ðŸŽ¤ Speak</button>

   <div class="admin-login">
       <h2>Admin Access</h2>
       <input type="text" id="admin-username" placeholder="Enter admin username" aria-label="Admin username">
       <input type="password" id="admin-password" placeholder="Enter admin password" aria-label="Admin password">
       <button id="login-btn">Login</button>
   </div>

   <div id="admin-panel" class="hidden">
       <h3>Add New Q&A</h3>
       <input type="text" id="new-question" placeholder="Enter new question trigger" aria-label="New question">
       <input type="text" id="new-answer" placeholder="Enter new answer" aria-label="New answer">
       <button id="add-qa-btn">Add Q&A</button>
   </div>

   <script>
       // Load responses from localStorage or default
       let responses = JSON.parse(localStorage.getItem("raybot-responses")) || {
           "HELLO": ["Hello! How can I help?", "Hey there!"],
           "AY": ["Ray is my creator", "RAY is good", "RAY is not bad", "RAY is in Guam"]
       };

       // Admin credentials (for now, keep basic)
       const correctUsername = "1";
       const correctPassword = "2";

       document.getElementById("login-btn").addEventListener("click", () => {
           const enteredUsername = document.getElementById("admin-username").value;
           const enteredPassword = document.getElementById("admin-password").value;
           if (enteredUsername === correctUsername && enteredPassword === correctPassword) {
               document.getElementById("admin-panel").classList.remove("hidden");
               alert("Access granted!");
           } else {
               alert("Incorrect username or password!");
           }
       });

       document.getElementById("send-btn").addEventListener("click", handleInput);
       document.getElementById("voice-btn").addEventListener("click", voiceInput);

       function handleInput() {
           const inputEl = document.getElementById("user-input");
           const userInput = inputEl.value.trim().toUpperCase();
           if (!userInput) return;
           addMessage("user-message", userInput);
           respond(userInput);
           inputEl.value = "";
       }

       function voiceInput() {
           const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
           recognition.lang = 'en-US';
           recognition.start();
           recognition.onresult = event => {
               const userInput = event.results[0][0].transcript.toUpperCase();
               addMessage("user-message", userInput);
               respond(userInput);
           };
       }

       function respond(input) {
           let matchedKey = Object.keys(responses).find(key => input.includes(key));
           const reply = matchedKey
               ? responses[matchedKey][Math.floor(Math.random() * responses[matchedKey].length)]
               : "I don't understand, can you rephrase?";
           addMessage("bot-message", reply);
           speak(reply);
       }

       function addMessage(className, message) {
           const chatBox = document.getElementById("chat-box");
           const msgDiv = document.createElement("div");
           msgDiv.className = className;
           msgDiv.innerText = message;
           chatBox.appendChild(msgDiv);
           chatBox.scrollTop = chatBox.scrollHeight;
       }

       function speak(text) {
           const synth = window.speechSynthesis;
           const utterance = new SpeechSynthesisUtterance(text);
           synth.speak(utterance);
       }

       document.getElementById("add-qa-btn").addEventListener("click", () => {
           const newQuestion = document.getElementById("new-question").value.trim().toUpperCase();
           const newAnswer = document.getElementById("new-answer").value.trim();
           if (newQuestion && newAnswer) {
               if (!responses[newQuestion]) responses[newQuestion] = [];
               responses[newQuestion].push(newAnswer);
               localStorage.setItem("raybot-responses", JSON.stringify(responses));
               alert("New Q&A added!");
               document.getElementById("new-question").value = "";
               document.getElementById("new-answer").value = "";
           } else {
               alert("Please enter both question and answer.");
           }
       });

       // Register service worker
       if ('serviceWorker' in navigator) {
           navigator.serviceWorker.register('service-worker.js')
               .then(reg => console.log('Service Worker Registered'))
               .catch(err => console.error('SW registration failed', err));
       }
   </script>
</body>
</html>

